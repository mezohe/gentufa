"use strict";

var GrammarError = require("../../grammar-error"),
    asts         = require("../asts"),
    visitor      = require("../visitor");

/* Checks that all referenced rules exist. */
function reportMissingRules(ast) {
  var ruleVisitor = visitor.build({
    rule: function (rule) {
      var params = rule.parameters || []
      var refVisitor = visitor.build({
        rule_ref: function (ref) {
          if (!asts.findRule(ast, ref.name) && !params.includes(ref.name)) {
            throw new GrammarError(
              "Referenced rule \"" + ref.name + "\" does not exist.",
              ref.location
            );
          }
        }
      });
      refVisitor(rule);
    }
  });
  ruleVisitor(ast);
}

module.exports = reportMissingRules;
